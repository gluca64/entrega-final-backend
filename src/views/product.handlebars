<h1>{{producto.title}}</h1>

<div style="background: white; padding: 2rem; border-radius: 8px; max-width: 600px;">
    <p><strong>Descripción:</strong> {{producto.description}}</p>
    <p><strong>Categoría:</strong> <span class="category">{{producto.category}}</span></p>
    <div class="price">Precio: ${{producto.price}}</div>
    <p><strong>Stock:</strong> {{producto.stock}}</p>
    <p><strong>Código:</strong> {{producto.code}}</p>
    <p><strong>Estado:</strong> {{#if producto.status}}Disponible{{else}}No disponible{{/if}}</p>

    <form id="formAgregarCarrito" style="margin-top: 2rem;">
        <label style="display: block; margin-bottom: 1rem;">
            Cantidad:
            <input type="number" id="cantidad" name="cantidad" value="1" min="1" style="padding: 0.5rem; width: 60px;">
        </label>
        <button type="submit" style="padding: 0.7rem 1.5rem; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem;">
            Agregar al Carrito
        </button>
    </form>

    <a href="/" style="display: inline-block; margin-top: 1rem; color: #666; text-decoration: none;">
        ← Volver al inicio
    </a>
</div>

<script>
// obtener el carrito del localStorage
function obtenerCarrito() {
    const carrito = localStorage.getItem('carrito');
    return carrito ? JSON.parse(carrito) : null;
}

// guardar carrito en localStorage
function guardarCarrito(carritoId) {
    localStorage.setItem('carrito', JSON.stringify(carritoId));
}

// agregar producto al carrito
document.getElementById('formAgregarCarrito').addEventListener('submit', async (e) => {
    e.preventDefault();

    const cantidad = parseInt(document.getElementById('cantidad').value);
    const productId = '{{producto._id}}';
    
    let carritoId = obtenerCarrito();

    // si no hay carrito, crear uno
    if (!carritoId) {
        try {
            const res = await fetch('/api/carts', { method: 'POST' });
            const data = await res.json();
            carritoId = data.cart._id;
            guardarCarrito(carritoId);
        } catch (error) {
            alert('Error al crear carrito');
            return;
        }
    }

    // agregar producto al carrito
    try {
        const res = await fetch(`/api/carts/${carritoId}/product/${productId}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ quantity: cantidad })
        });

        if (res.ok) {
            alert('Producto agregado al carrito!');
        } else {
            alert('Error al agregar producto');
        }
    } catch (error) {
        alert('Error: ' + error.message);
    }
});
</script>
